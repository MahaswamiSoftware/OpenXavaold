<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>openxava - mysql_es</title>
    <link rel="stylesheet" href="static/style.css" type="text/css">
    <link rel="stylesheet" href="highlight/highlight.css">
    <script src="highlight/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div class="wiki" style="display: block;">
      <h1 id="toc0">Configuración para MySQL</h1>
      Configurar tu aplicación OpenXava para ir contra MySQL es muy simple,
      básicamente has de instalar tu controlador JDBC para MySQL y definir
      correctamente la fuente de datos. No necesitas tocar nada de código de tu
      aplicación.</div>
    <div class="wiki" style="display: block;">Asumimos que ya tienes MySQL
      instalado y funcionando.<br>
      <h2 id="toc1">Descargar el controlador JDBC para MySQL</h2>
      <p>Descarga el controlador para MySQL desde aquí: <a href="https://dev.mysql.com/downloads/connector/j/">https://dev.mysql.com/downloads/connector/j/</a></p>
      Descargarás un archivo como este: <i>mysql-connector-java-8.0.17.zip</i>
      (el número de versión puede cambiar). Descomprímelo para buscar dentro un
      archivo llamado <i> mysql-connector-java-8.0.17.jar</i> (o parecido),
      este último archivo, el .jar, es el controlador JDBC que vamos a usar.</div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Crear una variable de classpath en Eclipse<br>
      </h2>
      Para poder conectar a MySQL desde Eclipse vamos a declarar una variable de
      classpath que apunte al controlador JDBC de MySQL, así lo podrás usar en
      cualquier proyecto que lo necesites con facilidad. Para ello, en Eclipse
      ve a <i>Window &gt; Preferences &gt; Java &gt; Build Path &gt; Classpath
        Variables</i> donde puedes añadir la nueva variable:</div>
    <img src="files/create-db-classpath-variable-eclipse_es.png" alt="" title="create-db-classpath-variable-eclipse_es.png">
    <div class="wiki" style="display: block;">Puedes llamar a la variable
      MYSQL_DRIVER o CONTROLADOR_MYSQL en lugar de DB_DRIVER si lo prefieres. <i>Path</i>
      sería la ruta del controlador JDBC, en nuestro caso la ruta del <i>mysql-connector-java-8.0.17.jar</i>
      que acabamos de descargar.<br>
      <strong></strong></div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Añadir la variable DB_DRIVER al proyecto Eclipse<br>
      </h2>
      En el proyecto en que vayas a usar MySQL has de añadir la variable que
      acabas de declarar. Pulsa con el botón derecho del ratón en tu proyecto y
      selecciona <i>Properties &gt; Java Build Path &gt; Libraries</i>:</div>
    <img src="files/add-db-classpath-variable-to-your-eclipse-project_es.png" title="add-db-classpath-variable-to-your-eclipse-project_es.png">
    <div class="wiki" style="display: block;">Con esto tenemos el controlador
      disponible en el entorno de desarrollo.</div>
    <div class="wiki" style="display: block;">
      <h2>Añadir el controlador JDBC al Tomcat de producción</h2>
      <h2><span style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;">Añadir
          el controlador en producción es mucho más fácil. Copia </span><span style="color: rgb(80, 80, 80); font-family: arial, helvetica, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;"><i>mysql-connector-java-8.0.17.jar</i>
          a la carpeta <i>lib</i> de tu Tomcat. Nada más.</span></h2>
    </div>
    <div class="wiki" style="display: block;"> </div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Ajustar la definición de la base de datos</h2>
      Para desarrollo edita <i>web/META-INF/context.xml</i> de tu proyecto
      Eclipse y para producción edita <i>conf/context.xml</i> de tu Tomcat,
      para ajustar la fuente de datos para que apunte a MySQL, algo como esto:</div>
    <div class="wiki" style="display: block;">
      <pre><code class="xml">&lt;Resource name="jdbc/MiAplicacionDS" auth="Container"
	type="javax.sql.DataSource"
	maxTotal="100" maxIdle="20" maxWaitMillis="10000"
	username="root" password="ao49fmsk"
	driverClassName="com.mysql.jdbc.Driver"
	url="jdbc:mysql://localhost:3306/"/&gt;
</code></pre> </div>
    <div class="wiki" style="display: block;">Las diferencias están en el <i>driverClassName</i>
      y la <i>url</i>. Obviamente, en lugar de <i>localhost</i> deberías poner
      la dirección del servidor donde está el MySQL, y también poner los valores
      correctos para <i>username</i> y <i>password</i>.</div>
    <div class="wiki" style="display: block;">
      <h2 id="toc1">Actualizar persistence.xml</h2>
      En la unidad de persistencia <i>default</i> de <i>persistence.xml</i>
      (en <i>persistence/META-INF</i>) has de cambiar la propiedad <i>hibernate.default_schema</i>
      por <i>hibernate.default_catalog. </i>Si usas la propiedad <i>hibernate.dialect</i>
      quítala.<br>
      <div class="wiki" style="display: block;">
        <pre><code class="xml">&lt;persistence-unit name="default"&gt;
	&lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;
	&lt;non-jta-data-source&gt;java://comp/env/jdbc/MiAplicacionDS&lt;/non-jta-data-source&gt;
	&lt;class&gt;org.openxava.session.GalleryImage&lt;/class&gt;
	&lt;class&gt;org.openxava.web.editors.DiscussionComment&lt;/class&gt;
	&lt;properties&gt;
		&lt;property name="javax.persistence.schema-generation.database.action" value="update"/&gt;
		&lt;property name="javax.persistence.create-database-schemas" value="true"/&gt; 
		&lt;property name="hibernate.default_catalog" value="miaplicaciondb"/&gt;
		&lt;property name="hibernate.jdbc.use_streams_for_binary" value="true"/&gt;
	&lt;/properties&gt;
&lt;/persistence-unit&gt;
</code></pre> </div>
      Fíjate como usamos <i>hibernate.default_catalog</i> para indicar tu base
      de datos MySQL, <i>miaplicaciondb</i> en este caso. </div>
    <div class="wiki" style="display: block;">Además, has de modificar la unidad
      de persistencia <i>junit</i> para que apunte a MySQL:<br>
      <div class="wiki" style="display: block;">
        <pre><code class="xml">&lt;!-- JUnit MySQL --&gt;
&lt;persistence-unit name="junit"&gt;
	&lt;provider&gt;org.hibernate.jpa.HibernatePersistenceProvider&lt;/provider&gt;
	&lt;class&gt;org.openxava.web.editors.DiscussionComment&lt;/class&gt;
	&lt;properties&gt;
		&lt;property name="hibernate.connection.driver_class" value="com.mysql.jdbc.Driver"/&gt;
		&lt;property name="hibernate.connection.username" value="root"/&gt;
		&lt;property name="hibernate.connection.password" value="ao49fmsk"/&gt;		
		&lt;property name="hibernate.connection.url" value="jdbc:mysql://localhost:3306/miaplicaciondb"/&gt;
	&lt;/properties&gt;
&lt;/persistence-unit&gt;
</code></pre> </div>
      <div class="wiki" style="display: block;">Adapta <i>username</i>, <i>password</i>
        y <i>url</i> a la configuración de tu MySQL.<br>
      </div>
    </div>
  </body>
</html>
