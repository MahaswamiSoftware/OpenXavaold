<?xml version="1.0"?>
<tl>&lt;?xml version="1.0" encoding="<expr>properties.getProperty("arg4")</expr>"?&gt;
<declare import="java.util.*"/>
<declare import="org.openxava.application.meta.*"/>
<declare import="org.openxava.generators.Generators"/>
<declare import="org.openxava.util.*"/>

&lt;!-- Generated by OpenXava: <expr>new Date()</expr> --&gt;

<java>
String applicationName = properties.getProperty("arg3");
MetaApplication application = MetaApplications.getMetaApplication(applicationName);
String encoding = properties.getProperty("arg4");

Collection locales = Generators.getAvailableLocales("../" + applicationName + "/i18n");
</java> 

&lt;portlet-app id="<expr>applicationName</expr>"
	xmlns="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd" 
	version="1.0" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd http://java.sun.com/xml/ns/portlet/portlet-app_1_0.xsd"
&gt;

<java>
for (Iterator it=application.getMetaModules().iterator(); it.hasNext(); ) {
	MetaModule module = (MetaModule) it.next();
	String description = module.getDescription();
	if (description == null || "".equals(description)) description = module.getLabel();
</java> 
	&lt;portlet id="<expr>Strings.toCharSet(module.getName(), encoding)</expr>"&gt;
		&lt;description&gt;<expr>Strings.toCharSet(application.getLabel(), encoding)</expr> - <expr>Strings.toCharSet(description, encoding)</expr>&lt;/description&gt;
    <java>for (Iterator itLocales=locales.iterator(); itLocales.hasNext(); ) { 
    	Locale locale = (Locale) itLocales.next();
    	String descriptionLocale = module.getDescription(locale);
    	if (descriptionLocale == null || "".equals(descriptionLocale)) descriptionLocale = module.getLabel(locale);
    </java>    
		<java>// Avoid to generate "en" locale description because the generated above (default) is English as portlet-app_1_0.xsd specifies. </java> 
		<java>// JetSpeed 2.2.1 throws a deployment error if this description is generated twice with the same locale </java>
		<java>if (!locale.getLanguage().equals("en") ) { </java>
		&lt;description xml:lang="<expr>locale</expr>"&gt;<expr>Strings.toCharSet(application.getLabel(locale), encoding)</expr> - <expr>Strings.toCharSet(descriptionLocale, encoding)</expr>&lt;/description&gt;
		<java>} </java>
	<java>} </java>       
		&lt;portlet-name&gt;<expr>Strings.toCharSet(module.getName(), encoding)</expr>&lt;/portlet-name&gt;
		&lt;display-name&gt;<expr>Strings.toCharSet(application.getLabel(), encoding)</expr> - <expr>Strings.toCharSet(module.getLabel(), encoding)</expr>&lt;/display-name&gt;
    <java>for (Iterator itLocales=locales.iterator(); itLocales.hasNext(); ) { 
    	Locale locale = (Locale) itLocales.next();
    </java>   
    	<java>// Avoid to generate "en" locale description because the generated above (default) is English as portlet-app_1_0.xsd specifies. </java>
		<java>// JetSpeed 2.2.1 throws a deployment error if this display-name is generated twice with the same locale </java>
		<java>if (!locale.getLanguage().equals("en") ) { </java> 
		&lt;display-name xml:lang="<expr>locale</expr>"&gt;<expr>Strings.toCharSet(application.getLabel(locale), encoding)</expr> - <expr>Strings.toCharSet(module.getLabel(locale), encoding)</expr>&lt;/display-name&gt;
		<java>} </java>
    <java>} </java> 
    <java>if (module.isDoc()) { </java> 
		&lt;portlet-class&gt;org.openxava.web.portlets.HtmlPortlet&lt;/portlet-class&gt;
		&lt;init-param&gt;
			&lt;name&gt;Page&lt;/name&gt;
			&lt;value&gt;<expr>module.getDocURL()</expr>&lt;/value&gt;
		&lt;/init-param&gt;
		&lt;init-param&gt;
			&lt;name&gt;Languages&lt;/name&gt;
			&lt;value&gt;<expr>module.getDocLanguages()</expr>&lt;/value&gt;
		&lt;/init-param&gt;		
	<java>} else { </java> 
		&lt;portlet-class&gt;org.openxava.web.portlets.XavaPortlet&lt;/portlet-class&gt;
		&lt;init-param&gt;
			&lt;name&gt;Application&lt;/name&gt;
			&lt;value&gt;<expr>Strings.toCharSet(applicationName, encoding)</expr>&lt;/value&gt;
		&lt;/init-param&gt;
		&lt;init-param&gt;
			&lt;name&gt;Module&lt;/name&gt;
			&lt;value&gt;<expr>Strings.toCharSet(module.getName(), encoding)</expr>&lt;/value&gt;
		&lt;/init-param&gt;			
	<java>} </java> 
		&lt;expiration-cache&gt;0&lt;/expiration-cache&gt;
		&lt;supports&gt;
			&lt;mime-type&gt;text/html&lt;/mime-type&gt;
			&lt;portlet-mode&gt;VIEW&lt;/portlet-mode&gt;
		&lt;/supports&gt;
    <java>for (Iterator itLocales=locales.iterator(); itLocales.hasNext(); ) { </java>
		&lt;supported-locale&gt;<expr>itLocales.next()</expr>&lt;/supported-locale&gt;
    <java>} </java> 
    	&lt;resource-bundle&gt;portlets/<expr>Strings.toCharSet(module.getName(), encoding)</expr>&lt;/resource-bundle&gt;
	&lt;/portlet&gt;
<java>
}
</java>   

@custom.portlets@

	&lt;user-attribute&gt;
		&lt;description&gt;User eMail&lt;/description&gt;
		&lt;name&gt;user.home-info.online.email&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Given Name&lt;/description&gt;
		&lt;name&gt;user.name.given&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Family Name&lt;/description&gt;
		&lt;name&gt;user.name.family&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Job Title&lt;/description&gt;
		&lt;name&gt;user.jobtitle&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Middle Name&lt;/description&gt;
		&lt;name&gt;user.name.middle&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Nick Name&lt;/description&gt;
		&lt;name&gt;user.name.nickName&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Birthday Year&lt;/description&gt;
		&lt;name&gt;user.bdate.ymd.year&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Birthday Month&lt;/description&gt;
		&lt;name&gt;user.bdate.ymd.month&lt;/name&gt;
	&lt;/user-attribute&gt;
	&lt;user-attribute&gt;
		&lt;description&gt;User Birthday Day&lt;/description&gt;
		&lt;name&gt;user.bdate.ymd.day&lt;/name&gt;
	&lt;/user-attribute&gt;
		
&lt;/portlet-app&gt;
</tl>